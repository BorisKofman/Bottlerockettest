name: Build Bottlerocket Kernel (Matrix)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        sdk_version: [x86_64-0.59.0, x86_64-0.60.0, x86_64-0.61.0]

    container:
      image: public.ecr.aws/bottlerocket/bottlerocket-sdk:${{ matrix.sdk_version }}
      options: --user root

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Build kernel
      run: |
        echo "Using Bottlerocket SDK version: ${{ matrix.sdk_version }}"
        git clone https://github.com/bottlerocket-os/bottlerocket /tmp/bottlerocket
        cd /tmp/bottlerocket
        ./tools/devtool setup